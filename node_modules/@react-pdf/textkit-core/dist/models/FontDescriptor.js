'use strict';

exports.__esModule = true;

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var FONT_WEIGHTS = {
  thin: 100,
  ultralight: 200,
  light: 300,
  normal: 400,
  medium: 500,
  semibold: 600,
  bold: 700,
  ultrabold: 800,
  heavy: 900
};

var FONT_WIDTHS = {
  ultracondensed: 1,
  extracondensed: 2,
  condensed: 3,
  semicondensed: 4,
  normal: 5,
  semiexpanded: 6,
  expanded: 7,
  extraexpanded: 8,
  ultraexpanded: 9
};

function parseFont(font) {
  // When we pass a fontkit TTFFont directly to texkit
  if ((typeof font === 'undefined' ? 'undefined' : (0, _typeof3.default)(font)) === 'object') {
    return {
      family: font.familyName,
      postscriptName: font.postscriptName
    };
  }

  if (typeof font !== 'string') {
    return {};
  }

  var parts = font.match(/(.+\.(?:ttf|otf|ttc|dfont|woff|woff2))(?:#(.+))$/);
  if (parts) {
    return {
      path: parts[1],
      postscriptName: parts[2]
    };
  }

  return { family: font };
}

function getFontWeight(weight) {
  if (typeof weight === 'number') {
    return Math.max(100, Math.min(900, Math.floor(weight / 100) * 100));
  }

  if (typeof weight === 'string') {
    return FONT_WEIGHTS[weight.toLowerCase().replace(/-/g, '')];
  }

  return null;
}

function getFontWidth(width) {
  if (typeof width === 'number') {
    return Math.max(1, Math.min(9, width));
  }

  if (typeof width === 'string') {
    return FONT_WIDTHS[width.toLowerCase().replace(/-/g, '')];
  }

  return null;
}

var FontDescriptor = function () {
  function FontDescriptor() {
    var attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
    (0, _classCallCheck3.default)(this, FontDescriptor);

    this.path = attributes.path;
    this.postscriptName = attributes.postscriptName;
    this.family = attributes.family;
    this.style = attributes.style;
    this.weight = attributes.weight;
    this.width = attributes.width;
    this.italic = attributes.italic;
    this.monospace = attributes.monospace;
  }

  FontDescriptor.fromAttributes = function fromAttributes() {
    var attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    if (attributes.fontDescriptor) {
      return new FontDescriptor(attributes.fontDescriptor);
    }

    var font = parseFont(attributes.font || 'Helvetica');
    return new FontDescriptor({
      path: font.path,
      postscriptName: attributes.fontPostscriptName || font.postscriptName,
      family: attributes.fontFamily || font.family,
      style: attributes.fontStyle,
      weight: getFontWeight(attributes.fontWeight) || (attributes.bold ? FONT_WEIGHTS.bold : null),
      width: getFontWidth(attributes.fontWidth),
      italic: attributes.italic,
      monospace: attributes.monospace
    });
  };

  return FontDescriptor;
}();

exports.default = FontDescriptor;